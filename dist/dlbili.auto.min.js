const dlbiliAuto=async(t,e=!1)=>{const l={ENFOURCE_RPC:e,VIDEO_QUALITY:t,MAX_DOWNLOAD_PAGES:32,DEFAULT_RPC_URL:"http://localhost:6800/jsonrpc",DEFAULT_RPC_METHOD:"POST"},o={V_INFO:"https://api.bilibili.com/x/web-interface/view?",V_URL:"https://api.bilibili.com/x/player/playurl?"};var i,c,s,d,h,u;const g=window.bvid,r=window.p+1,w=window.btoa,a=window.j;window.rpcUrl=window.rpcUrl||l.DEFAULT_RPC_URL,window.rpcMethod=window.rpcMethod||l.DEFAULT_RPC_METHOD,await new Promise(e=>{$.ajax({url:o.V_INFO+"bvid="+g,type:"GET",dataType:"json",success:t=>{e(t.data)}})}).then(t=>{i=t.pages,c=t.title,d=i.length.toString().length});const b=t=>{t=t.replace(/\?.*/,"").split(".");return"."+t[t.length-1]},f=t=>t.replace(/[\u002a\u002e\u003f\u0022\u003c\u003e\u007c\u002f\u005c]/g,"_"),P=async(r,a,e,n)=>{for(let t=0;t<e.length;t++){var o=b(e[t]),l=t.toString().padStart(e.length.toString().length,"0"),i={id:g+"-"+(new Date).getTime(),method:"aria2.addUri",params:[[e[t]],{out:""+n+(e.length-1?" Part "+l:"")+o,referer:window.location.href}]};"GET"==a&&(i.params=w((r=>{let a="";for(let e=0;e<r.length;e++){let t=r[e];a+=/[^\x00-\xFF]/.test(t)?"\\u"+t.charCodeAt().toString(16).padStart(4,"0"):t}return a})(JSON.stringify(i.params)))),await new Promise(e=>{$.ajax({url:r,data:"GET"==a?i:JSON.stringify(i),type:a,contentType:"application/json-rpc",dataType:"json",success:t=>{t.result?h++:u++,e()},error:()=>{u++,e()}})})}};await a("https://cdn.jsdelivr.net/gh/Stuk/jszip@3.7.1/dist/jszip.min.js");const E=async(t,e,n)=>{const o=b(t[0]),r=window.URL||window.webkitURL||window;var a=document.createElementNS("http://www.w3.org/1999/xhtml","a");var l,t=await(async e=>{var r=[];for(let t=0;t<e.length;t++)try{var a=await(r=>new Promise(t=>{let e=new XMLHttpRequest;e.open("GET",r,!0),e.responseType="blob",e.onload=()=>{200===e.status&&t(e.response)},e.send()}))(e[t]);r.push({name:n+" "+t.toString().padStart(e.length.toString().length,"0")+o,blob:new Blob([a])})}catch(t){}return r})(t);t.length-1?(l=new JSZip,t.forEach(t=>{t&&l.file(t.name,t.blob)}),l.generateAsync({type:"blob"}).then(t=>{a.href=r.createObjectURL(t),a.download=e,a.click(),r.revokeObjectURL(a.href)})):t.length?(a.href=r.createObjectURL(t[0].blob),a.download=e+o,a.click(),r.revokeObjectURL(a.href)):alert("\u4e0b\u8f7d\u5931\u8d25\uff01")},O=async(t=1,e=!1)=>{if(e||!l.ENFOURCE_RPC){var r=[];if(moreThanOneP=!!(i.length-1),await new Promise(e=>{$.ajax({url:o.V_URL+"cid="+i[t-1].cid+"&"+l.VIDEO_QUALITY+"&bvid="+g,type:"GET",dataType:"json",success:t=>{e(t.data)}})}).then(t=>{s=120<=t.quality,t.durl.forEach(t=>{r.push(t.url)})}),e||!s){var a=f(moreThanOneP?i[t-1].part:c),n=`${g}${moreThanOneP?"_p"+t.toString().padStart(d,"0"):""} `+a;if(e)return[r,n];E(r,n,a),alert("\u5df2\u53d1\u9001\u4e0b\u8f7d\uff01\u8bf7\u7b49\u5f85\u540e\u53f0\u4e0b\u8f7d\u5b8c\u6210\u3002")}else T([t])}else T([t])},T=async e=>{var t,r;let a=0;if(null!=(t=prompt("\u8bf7\u8f93\u5165RPC\u5730\u5740"+`
（默认：${rpcUrl}）`))){for(t=t||rpcUrl,a=0;r=prompt((a?"\u8f93\u5165\u9519\u8bef\uff01\u53ea\u80fd\u8f93\u5165 POST \u6216 GET\n\n":"")+"\u8bf7\u8f93\u5165RPC\u8bf7\u6c42\u65b9\u6cd5 ( POST | GET )"+`
（默认：${rpcMethod}）`),a=null!=r?["POST","GET",""].includes(r.toUpperCase())?(r=r||rpcMethod,0):1:0,a;);if(null!=r){for(let t=h=u=0;t<e.length;t++){var n=await O(e[t],!0);await P(rpcUrl,rpcMethod,n[0],n[1])}h?(alert("\u5df2\u5c1d\u8bd5\u53d1\u9001"+`
- 成功 ${h} | 失败 `+u+"\n\u8bf7\u5728\u4f60\u7684RPC\u5ba2\u6237\u7aef\u67e5\u770b\u4e0b\u8f7d\u3002"),rpcUrl=t,rpcMethod=r):alert("\u53d1\u9001\u5931\u8d25\uff0c\u4f60\u53ef\u4ee5\u5c1d\u8bd5\u8fd9\u6837\u505a\uff1a\n- \u68c0\u67e5\u4f60\u7684RPC\u5ba2\u6237\u7aef\u662f\u5426\u5f00\u542f\n- \u68c0\u67e5RPC\u5730\u5740\u662f\u5426\u4e3a "+t+`
- 检查RPC请求方法是否为 `+r)}}};const n=(t="")=>{t=t+"\u8bf7\u5728\u4e0b\u6846\u4e2d\u8f93\u5165\u4f60\u8981\u4e0b\u8f7d\u7684\u5206\u96c6\uff08\u9ed8\u8ba4\u4e3a\u5f53\u524dP\uff09\n\uff08\u5982\u8f93\u5165\u300c1,2,7-9,15\u300d\uff09"+`
单次下载超过${l.MAX_DOWNLOAD_PAGES}集可能会有账号风险`+"\n- \u5206\u96c6\u5217\u8868\u5df2\u8f93\u51fa\u81f3\u63a7\u5236\u53f0";let a=prompt(t);if(null!==a)if(""==a)O(r);else{let e=[],r=!0;const o=t=>{r&&t&&t<=i.length?e.includes(t)||e.push(t):r=!1};let t=a.split(",");t.forEach(n=>{n.includes("-")?(()=>{var t=n.split("-"),e=r=parseInt(t[0])||0,r=(a=parseInt(t[1])||0)<r?a:r,a=e<a?a:e;for(let t=r;t<=a;t++)o(t)})():o(parseInt(n))}),e.length&&r?e.length<=l.MAX_DOWNLOAD_PAGES?(e.sort((t,e)=>t-e),e.length-1?T(e):O(e[0])):n(`为了您的账号安全，单次下载请不要超过${l.MAX_DOWNLOAD_PAGES}集。

`):n("\u8f93\u5165\u683c\u5f0f\u9519\u8bef\u6216\u8005\u5206P\u4e0d\u5b58\u5728\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\uff01\n\n")}};i.length-1?((()=>{const e={title:"color:#FFF;background-color:#0055BA;border-radius:10%;font-size:larger",page:"color:#FFF;background-color:green;border-radius:20%;",pageCur:"color:#FFF;background-color:#0055BA;border-radius:20%;",part:"margin-left:10px;",partCur:"color:#FFF;background-color:#C63;border-radius:20%;margin-left:10px;"};console.clear(),console.info("%c \u5206P\u5217\u8868 ",e.title),i.forEach(t=>{console.info(`%c ${t.page.toString().padStart(d,"0")} %c ${t.part} `,t.page==r?e.pageCur:e.page,t.page==r?e.partCur:e.part)})})(),n()):O()};window.dlbAuto=!0;