/*! dlbili.cur.js v0.1.0 | MIT License | github.com/cnily03/bili-download */
const dlbiliCur=async e=>{const r={NORMAL:"https://api.bilibili.com/x/player/playurl",EP:"https://api.bilibili.com/pugv/player/web/playurl"},i=e;let t=window.location.pathname.split("/").reverse()[0];const l=window.bvid||"",n="ep"==t.slice(0,2)?t.slice("2"):"",o=window.cid||"",a=window.p?window.p+1:function(){try{var e=document.querySelector(".list-box").childNodes,t=0;for(const r of e)if(t++,"on"==r.classList[0])break;return t}catch(e){return 0}}(),s=window.j;await s("https://cdn.jsdelivr.net/gh/Stuk/jszip@3.7.1/dist/jszip.min.js");var c,u=async(e,t,n)=>{const r=window.URL||window.webkitURL||window;var i=document.createElementNS("http://www.w3.org/1999/xhtml","a");var l,e=await(async t=>{var r=[];for(let e=0;e<t.length;e++)try{var i=await(r=>new Promise(e=>{let t=new XMLHttpRequest;t.open("GET",r,!0),t.responseType="blob",t.onload=()=>{200===t.status&&e(t.response)},t.send()}))(t[e].url),l=t[e].suffix||(e=>{e=e.replace(/\?.*/,"").split(".");return"."+e[e.length-1]})(t[e].url);r.push({name:n+".part"+e.toString().padStart(t.length.toString().length,"0")+l,blob:new Blob([i])})}catch(e){}return r})(e);e.length-1?(l=new JSZip,e.forEach(e=>{e&&l.file(e.name,e.blob)}),l.generateAsync({type:"blob"}).then(e=>{i.href=r.createObjectURL(e),i.download=t,i.click(),r.revokeObjectURL(i.href)})):e.length?(i.href=r.createObjectURL(e[0].blob),i.download=t+suffix,i.click(),r.revokeObjectURL(i.href)):alert("\u4e0b\u8f7d\u5931\u8d25\uff01")},d=[];await new Promise(t=>{$.ajax({url:n?`${r.EP}?${i}&fnval=16&ep_id=`+n:`${r.NORMAL}?${i}&cid=${o}&bvid=`+l,type:"GET",dataType:"json",xhrFields:{withCredentials:!0},success:e=>{Object.keys(e.data).includes("durl")?t(e.data.durl):t(e.data.dash)}})}).then(e=>{Array.isArray(e)?e.forEach(e=>{d.push({url:e.url})}):(d.push({url:e.video[0].base_url,suffix:"."+e.video[0].mime_type.split("/").reverse()[0]}),d.push({url:e.audio[0].base_url,suffix:".audio."+e.audio[0].mime_type.split("/").reverse()[0]}))}),n?(e=document.querySelector(".season-info h1.title").innerText,c=document.querySelector(".on.list-box-li .title").innerText,c=a?`${e} - ${a.toString().padStart(document.querySelector(".list-box").childNodes.length.toString().length,"0")} `+c:c+" "+c,u(d,c,c)):(c=document.querySelector(".video-title.tit").innerText.replace(/[\u002a\u002e\u003f\u0022\u003c\u003e\u007c\u002f\u005c]/g,"_"),u(d,`${l}_p${a} `+c,c+"_p"+a)),alert("\u5df2\u53d1\u9001\u4e0b\u8f7d\uff01\u8bf7\u7b49\u5f85\u540e\u53f0\u4e0b\u8f7d\u5b8c\u6210\u3002")};window.dlbCur=!0;