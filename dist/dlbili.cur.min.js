/*! dlbili.cur.js v0.1.0 | MIT License | github.com/cnily03/bili-download */
const dlbiliCur=async e=>{const r={NORMAL:"https://api.bilibili.com/x/player/playurl",EP:"https://api.bilibili.com/pugv/player/web/playurl"},l=e;let t=window.location.pathname.split("/").reverse()[0];const n=window.bvid||"",o="ep"==t.slice(0,2)?t.slice("2"):"",a=window.cid||"",s=window.p?window.p+1:function(){try{var e=document.querySelector(".list-box").childNodes,t=0;for(const r of e)if(t++,"on"==r.classList[0])break;return t}catch(e){return 0}}(),c=window.j,u=e=>{e=e.replace(/\?.*/,"").split(".");return"."+e[e.length-1]};await c("https://cdn.jsdelivr.net/gh/Stuk/jszip@3.7.1/dist/jszip.min.js");var d,w=async(e,t,n)=>{const r=window.URL||window.webkitURL||window;var l=document.createElementNS("http://www.w3.org/1999/xhtml","a");var o,a=await(async t=>{var r=[];for(let e=0;e<t.length;e++)try{var i=await(r=>new Promise(e=>{let t=new XMLHttpRequest;t.open("GET",r,!0),t.responseType="blob",t.onload=()=>{200===t.status&&e(t.response)},t.send()}))(t[e].url),l=t[e].suffix||u(t[e].url);r.push({name:n+".part"+e.toString().padStart(t.length.toString().length,"0")+l,blob:new Blob([i])})}catch(e){}return r})(e);a.length-1?(o=new JSZip,a.forEach(e=>{e&&o.file(e.name,e.blob)}),o.generateAsync({type:"blob"}).then(e=>{l.href=r.createObjectURL(e),l.download=t,l.click(),r.revokeObjectURL(l.href)})):a.length?(e=e[i].suffix||u(e[i].url),l.href=r.createObjectURL(a[0].blob),l.download=t+e,l.click(),r.revokeObjectURL(l.href)):alert("\u4e0b\u8f7d\u5931\u8d25\uff01")},h=[];await new Promise(t=>{$.ajax({url:o?`${r.EP}?${l}&fnval=16&ep_id=`+o:`${r.NORMAL}?${l}&cid=${a}&bvid=`+n,type:"GET",dataType:"json",xhrFields:{withCredentials:!0},success:e=>{Object.keys(e.data).includes("durl")?t(e.data.durl):t(e.data.dash)}})}).then(e=>{Array.isArray(e)?e.forEach(e=>{h.push({url:e.url})}):(h.push({url:e.video[0].base_url,suffix:"."+e.video[0].mime_type.split("/").reverse()[0]}),h.push({url:e.audio[0].base_url,suffix:".audio."+e.audio[0].mime_type.split("/").reverse()[0]}))}),o?(e=document.querySelector(".season-info h1.title").innerText,d=document.querySelector(".on.list-box-li .title").innerText,d=s?`${e} - ${s.toString().padStart(document.querySelector(".list-box").childNodes.length.toString().length,"0")} `+d:d+" "+d,w(h,d,d)):(d=document.querySelector(".video-title.tit").innerText.replace(/[\u002a\u002e\u003f\u0022\u003c\u003e\u007c\u002f\u005c]/g,"_"),w(h,`${n}_p${s} `+d,d+"_p"+s)),alert("\u5df2\u53d1\u9001\u4e0b\u8f7d\uff01\u8bf7\u7b49\u5f85\u540e\u53f0\u4e0b\u8f7d\u5b8c\u6210\u3002")};window.dlbCur=!0;