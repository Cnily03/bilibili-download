/*! dlbili.cur.min.js v0.1.0 | MIT License | github.com/cnily03/bili-download */
const dlbiliCur=async e=>{const t=e,n=window.bvid,a=window.cid,r=window.p+1,l=window.j;await l("https://cdn.jsdelivr.net/gh/Stuk/jszip@3.7.1/dist/jszip.min.js");var o=[];await new Promise(e=>{$.ajax({url:"https://api.bilibili.com/x/player/playurl?cid="+a+"&"+t+"&bvid="+n,type:"GET",dataType:"json",success:t=>{e(t.data.durl)}})}).then(e=>{e.forEach(e=>{o.push(e.url)})});var i=document.querySelector("span.tit").innerText.replace(/[\u002a\u002e\u003f\u0022\u003c\u003e\u007c\u002f\u005c]/g,"_");(async(e,t,n)=>{const a=(e=>{let t=e.replace(/\?.*/,"").split(".");return"."+t[t.length-1]})(e[0]),r=window.URL||window.webkitURL||window;var l=document.createElementNS("http://www.w3.org/1999/xhtml","a");const o=e=>new Promise(t=>{let n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.onload=(()=>{200===n.status&&t(n.response)}),n.send()});var i=await(async e=>{var t=[];for(let r=0;r<e.length;r++)try{let l=await o(e[r]);t.push({name:n+" "+r.toString().padStart(e.length.toString().length,"0")+a,blob:new Blob([l])})}catch(e){}return t})(e);if(i.length-1){var c=new JSZip;i.forEach(e=>{e&&c.file(e.name,e.blob)}),c.generateAsync({type:"blob"}).then(e=>{l.href=r.createObjectURL(e),l.download=t,l.click(),r.revokeObjectURL(l.href)})}else i.length?(l.href=r.createObjectURL(i[0].blob),l.download=t+a,l.click(),r.revokeObjectURL(l.href)):alert("下载失败！")})(o,n+"_p"+r+" "+i,i+"_p"+r),alert("已发送下载！请等待后台下载完成。")};window.dlbCur=!0;