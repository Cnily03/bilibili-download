const queryParam=function(){let e=window.location.search.substring(1),t=e.split("&"),o={};return t.forEach(e=>{e=e.split("=");e.length-1&&e[0]&&(o[unescape(e[0])]=unescape(e[1]))}),o}(),DLBILI={HOST:"https://cdn.jsdelivr.net/gh/Cnily03",DIR:(()=>{let e=window.location.pathname.split("/");return e[e.length-2]+="@master",e[e.length-1]="",e.join("/")})(),SUB_DIR:"dist/"},QUAILITY_TABLE={HDR:125,"4K":120,"1080p60":116,"1080p+":112,"1080p":80,"720p60":74,"720p":64,"480p":32,"360p":16,"240p":6},js_addJS="j=t=>new Promise(r=>{let e=document.createElement('script');e.type='text/javascript',e.src=t,e.readyState?e.onreadystatechange=(()=>{['loaded','complete'].includes(e.readyState)&&r()}):e.onload=(()=>{r()});document.getElementsByTagName('head')[0].appendChild(e)});";var query=queryParam.query||"",quality=queryParam.quality||"1080p+",enforceRPC=!!queryParam["enforce-rpc"];const qs=[query,quality,enforceRPC];function genQnParam(e=quality){return"qn="+e+(e==QUAILITY_TABLE["4K"]?"&fourk=1":"")}function updateBiliUrl(e=query){var t;return e.length&&(e=(e=(e=e.replace(/(.*\/)|(\?.*)/g,"")).replace(/[^a-z0-9]/gi,"")).length-1&&(t=[null,"av","BV"][["av","bv"].indexOf(e.slice(0,2).toLowerCase())+1])?e.slice(2,e.length):e)?(t=t||(/^[0-9]*$/.test(e)?"av":"BV"),url="av"==t&&/[^0-9]/.test(e)?null:"https://b23.tv/"+t+e,window.biliVideoUrl=url,url):window.biliVideoUrl=null}var quality=QUAILITY_TABLE[quality],biliVideoUrl=updateBiliUrl();const putAsync=e=>`(async()=>{${e}})()`,zipTxt=t=>{let o="";for(let e=0;e<t.length;e++){const n=t[e];o+=/[^\x00-\xFF]/.test(n)?"\\u"+n.charCodeAt().toString(16).padStart(4,"0"):n}return"eval(window.atob('"+window.btoa(o)+"'))"},genEvalStr={gen:(e,t,o)=>putAsync(js_addJS+`if(!${o})await j('${DLBILI.HOST}${DLBILI.DIR}${DLBILI.SUB_DIR}${e}');`+t),auto:()=>genEvalStr.gen("dlbili.auto.min.js","dlbiliAuto('"+genQnParam()+(enforceRPC?",1":"")+"')","window.dlbAuto"),cur:()=>genEvalStr.gen("dlbili.cur.min.js","dlbiliCur('"+genQnParam()+"')","window.dlbCur"),evolved:()=>js_addJS+`if(!window.biliEvolved)j('${DLBILI.HOST}${DLBILI.DIR}${DLBILI.SUB_DIR}addEvolved.min.js')`};function updateOutput(){document.querySelector("#output #auto").value=zipTxt(genEvalStr.auto()),quality<120?(document.querySelector("#output #cur").value=zipTxt(genEvalStr.cur()),document.querySelector("#output #cur").classList.remove("unsupport"),document.querySelector("button#copy-cur").disabled=!1):(document.querySelector("#output #cur").value="4K 及以上画质不支持网页下载，请使用「"+document.querySelector("label[for='auto']").innerText+"」脚本",document.querySelector("#output #cur").classList.add("unsupport"),document.querySelector("button#copy-cur").disabled=!0)}var onCopy={auto:!1,cur:!1},supportCopy=!0;const copyText=t=>{if(!onCopy[t]){if(onCopy[t]=!0,supportCopy){var e=e=>{e.clipboardData.setData("text/plain",document.querySelector("textarea#"+t).value),e.preventDefault()};document.addEventListener("copy",e);try{document.execCommand("copy"),document.removeEventListener("copy",e),document.querySelector("button#copy-"+t).innerText="已复制",document.querySelector("button#copy-"+t).classList.add("btn-success"),setTimeout(()=>{document.querySelector("button#copy-"+t).innerText="复制",document.querySelector("button#copy-"+t).classList.remove("btn-success")},500)}catch(e){supportCopy=!1;var o=document.querySelectorAll("button.copy");for(let t=0;t<o.length;t++){let e=o[t];e.innerText="选中全部"}alert("你的浏览器不支持自动复制，请手动复制！"),document.querySelector("textarea#"+t).select()}}else document.querySelector("textarea#"+t).select(),document.querySelector("button#copy-"+t).innerText="请手动复制",document.querySelector("button#copy-"+t).classList.add("btn-success"),setTimeout(()=>{document.querySelector("button#copy-"+t).innerText="选中全部",document.querySelector("button#copy-"+t).classList.remove("btn-success")},1e3);onCopy[t]=!1}};function autoShowGoBiliBtn(){var e=document.querySelector("#go-bili");query=document.querySelector("input[name=query]").value,(biliVideoUrl=updateBiliUrl())?(e.onclick=()=>{window.open(biliVideoUrl)},e.style.display="inline-block"):(e.style.display="none",e.onclick=null)}document.addEventListener("DOMContentLoaded",function(){document.querySelector("select[name=quality]").onchange=()=>{quality=document.querySelectorAll("select[name=quality] option")[document.querySelector("select[name=quality]").selectedIndex].value,quality=QUAILITY_TABLE[quality],updateOutput()},window.enforceRpcDom=document.querySelectorAll("input[name=enforce-rpc]"),enforceRpcDom[1].onchange=()=>{enforceRPC=enforceRpcDom[0].checked=enforceRpcDom[1].checked,updateOutput()},document.querySelector("input[name=query]").value=qs[0],document.querySelector("select[name=quality]").options[Object.keys(QUAILITY_TABLE).indexOf(qs[1])].selected=!0,enforceRpcDom[0].checked=enforceRpcDom[1].checked=qs[2],autoShowGoBiliBtn(),void 0!==document.querySelector("input[name=query]").oninput?document.querySelector("input[name=query]").oninput=autoShowGoBiliBtn:document.querySelector("input[name=query]").onpropertychange=autoShowGoBiliBtn,document.querySelector("button#copy-auto").onclick=()=>{copyText("auto")},document.querySelector("button#copy-cur").onclick=()=>{copyText("cur")},document.querySelector("button#copy-evolved").onclick=()=>{copyText("evolved")},updateOutput(),document.querySelector("#output-evolved #evolved").value=zipTxt(genEvalStr.evolved())}),document.addEventListener("DOMContentLoaded",function(){window.evolvedBox=document.querySelector("#output-evolved .box"),evolvedBox.classList.add("temp"),document.documentElement.style.setProperty("--evolved-height",evolvedBox.clientHeight+"px"),evolvedBox.classList.remove("temp"),window.onAnimateEvolved=!1,document.querySelector("#output-evolved #control").onclick=()=>{onAnimateEvolved||(onAnimateEvolved=!0,evolvedBox.classList.contains("open")?evolvedBox.classList.contains("open")&&(evolvedBox.classList.remove("open"),evolvedBox.classList.add("close")):(evolvedBox.classList.remove("close"),evolvedBox.classList.add("open")),onAnimateEvolved=!1)};var e=document.querySelector("footer");e.style.transform="translateY("+(document.body.clientHeight-window.innerHeight?0:document.body.clientHeight-e.offsetTop-e.clientHeight)+"px)"});